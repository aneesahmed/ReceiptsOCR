<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cropper</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .upload-box {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }

        .upload-box.drag-over {
            background: #e8ebff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .canvas-section {
            position: relative;
        }

        .canvas-container {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
            display: inline-block;
            max-width: 100%;
        }

        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }

        .crop-box {
            position: absolute;
            border: 2px solid #667eea;
            background: rgba(102, 126, 234, 0.1);
            cursor: move;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        }

        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
        }

        .resize-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
        .resize-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
        .resize-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }

        .controls-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .preview-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .preview-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .preview-canvas {
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            max-width: 100%;
        }

        .success-message {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>üñºÔ∏è Image Cropper</h1>

            <div class="upload-section">
                <div 
                    class="upload-box"
                    :class="{ 'drag-over': isDragging }"
                    @click="$refs.fileInput.click()"
                    @dragover.prevent="isDragging = true"
                    @dragleave.prevent="isDragging = false"
                    @drop.prevent="handleDrop"
                >
                    <div class="upload-icon">üìÅ</div>
                    <p><strong>Click to upload</strong> or drag and drop</p>
                    <p style="color: #999; font-size: 14px; margin-top: 8px;">PNG, JPG, JPEG up to 10MB</p>
                    <input 
                        type="file" 
                        ref="fileInput"
                        accept="image/*"
                        @change="handleFileUpload"
                    >
                </div>
            </div>

            <div v-if="imageLoaded" class="main-content">
                <div class="canvas-section">
                    <div class="canvas-container">
                        <canvas ref="canvas"></canvas>
                        <div 
                            v-if="cropData.width > 0 && cropData.height > 0"
                            class="crop-box"
                            :style="cropBoxStyle"
                            @mousedown="startDrag"
                        >
                            <div class="resize-handle nw" @mousedown.stop="startResize('nw', $event)"></div>
                            <div class="resize-handle ne" @mousedown.stop="startResize('ne', $event)"></div>
                            <div class="resize-handle sw" @mousedown.stop="startResize('sw', $event)"></div>
                            <div class="resize-handle se" @mousedown.stop="startResize('se', $event)"></div>
                        </div>
                    </div>

                    <div class="preview-section">
                        <div class="preview-title">Cropped Preview:</div>
                        <canvas ref="previewCanvas" class="preview-canvas"></canvas>
                    </div>
                </div>

                <div class="controls-section">
                    <div class="form-group">
                        <label>Original File Name</label>
                        <input 
                            type="text" 
                            v-model="cropData.fileName" 
                            placeholder="original-file.jpg"
                            readonly
                        >
                    </div>

                    <div class="form-group">
                        <label>New File Name</label>
                        <input 
                            type="text" 
                            v-model="cropData.updateFileName" 
                            placeholder="cropped-file.jpg"
                        >
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label>X Position</label>
                            <input 
                                type="number" 
                                v-model.number="cropData.x" 
                                @input="updateCropBox"
                                min="0"
                            >
                        </div>
                        <div class="form-group">
                            <label>Y Position</label>
                            <input 
                                type="number" 
                                v-model.number="cropData.y"
                                @input="updateCropBox"
                                min="0"
                            >
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label>Width</label>
                            <input 
                                type="number" 
                                v-model.number="cropData.width"
                                @input="updateCropBox"
                                min="1"
                            >
                        </div>
                        <div class="form-group">
                            <label>Height</label>
                            <input 
                                type="number" 
                                v-model.number="cropData.height"
                                @input="updateCropBox"
                                min="1"
                            >
                        </div>
                    </div>

                    <button class="btn btn-secondary" @click="resetCrop">Reset Crop</button>
                    <button class="btn btn-secondary" @click="downloadCroppedImage" :disabled="!isValidCrop">
                        üì• Download Cropped Image
                    </button>
                    <button class="btn btn-primary" @click="submitCrop" :disabled="!isValidCrop">
                        Submit Crop Data
                    </button>

                    <div v-if="showSuccess" class="success-message">
                        ‚úÖ Crop data submitted successfully!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isDragging: false,
                    imageLoaded: false,
                    image: null,
                    cropData: {
                        fileName: '',
                        updateFileName: '',
                        x: 0,
                        y: 0,
                        width: 0,
                        height: 0
                    },
                    isDraggingCrop: false,
                    isResizing: false,
                    resizeDirection: '',
                    dragStart: { x: 0, y: 0 },
                    cropStart: { x: 0, y: 0, width: 0, height: 0 },
                    canvasScale: 1,
                    showSuccess: false
                }
            },
            computed: {
                cropBoxStyle() {
                    return {
                        left: `${this.cropData.x * this.canvasScale}px`,
                        top: `${this.cropData.y * this.canvasScale}px`,
                        width: `${this.cropData.width * this.canvasScale}px`,
                        height: `${this.cropData.height * this.canvasScale}px`
                    };
                },
                isValidCrop() {
                    return this.cropData.width > 0 && 
                           this.cropData.height > 0 && 
                           this.cropData.updateFileName.trim() !== '';
                }
            },
            methods: {
                handleDrop(e) {
                    this.isDragging = false;
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.loadImage(files[0]);
                    }
                },
                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (file) {
                        this.loadImage(file);
                    }
                },
                loadImage(file) {
                    if (!file.type.startsWith('image/')) {
                        alert('Please upload an image file');
                        return;
                    }

                    this.cropData.fileName = file.name;
                    this.cropData.updateFileName = file.name.replace(/\.[^/.]+$/, '') + '-cropped' + file.name.match(/\.[^/.]+$/)[0];

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            this.image = img;
                            this.imageLoaded = true;
                            this.$nextTick(() => {
                                this.drawImage();
                                this.initializeCrop();
                            });
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },
                drawImage() {
                    const canvas = this.$refs.canvas;
                    const ctx = canvas.getContext('2d');
                    
                    const maxWidth = 700;
                    const maxHeight = 500;
                    
                    let width = this.image.width;
                    let height = this.image.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    this.canvasScale = width / this.image.width;
                    
                    ctx.drawImage(this.image, 0, 0, width, height);
                },
                initializeCrop() {
                    const margin = Math.floor(this.image.width * 0.1);
                    this.cropData.x = margin;
                    this.cropData.y = margin;
                    this.cropData.width = this.image.width - margin * 2;
                    this.cropData.height = this.image.height - margin * 2;
                    this.updatePreview();
                },
                startDrag(e) {
                    this.isDraggingCrop = true;
                    this.dragStart = { x: e.clientX, y: e.clientY };
                    this.cropStart = { ...this.cropData };
                    
                    document.addEventListener('mousemove', this.onDrag);
                    document.addEventListener('mouseup', this.stopDrag);
                },
                onDrag(e) {
                    if (this.isDraggingCrop) {
                        const dx = (e.clientX - this.dragStart.x) / this.canvasScale;
                        const dy = (e.clientY - this.dragStart.y) / this.canvasScale;
                        
                        this.cropData.x = Math.max(0, Math.min(this.image.width - this.cropData.width, this.cropStart.x + dx));
                        this.cropData.y = Math.max(0, Math.min(this.image.height - this.cropData.height, this.cropStart.y + dy));
                        
                        this.cropData.x = Math.round(this.cropData.x);
                        this.cropData.y = Math.round(this.cropData.y);
                        
                        this.updatePreview();
                    } else if (this.isResizing) {
                        this.onResize(e);
                    }
                },
                stopDrag() {
                    this.isDraggingCrop = false;
                    this.isResizing = false;
                    document.removeEventListener('mousemove', this.onDrag);
                    document.removeEventListener('mouseup', this.stopDrag);
                },
                startResize(direction, e) {
                    this.isResizing = true;
                    this.resizeDirection = direction;
                    this.dragStart = { x: e.clientX, y: e.clientY };
                    this.cropStart = { ...this.cropData };
                    
                    document.addEventListener('mousemove', this.onDrag);
                    document.addEventListener('mouseup', this.stopDrag);
                },
                onResize(e) {
                    const dx = (e.clientX - this.dragStart.x) / this.canvasScale;
                    const dy = (e.clientY - this.dragStart.y) / this.canvasScale;
                    
                    const dir = this.resizeDirection;
                    
                    if (dir.includes('n')) {
                        const newY = Math.max(0, this.cropStart.y + dy);
                        const newHeight = this.cropStart.height - (newY - this.cropStart.y);
                        if (newHeight > 10) {
                            this.cropData.y = newY;
                            this.cropData.height = newHeight;
                        }
                    }
                    if (dir.includes('s')) {
                        this.cropData.height = Math.max(10, Math.min(this.image.height - this.cropData.y, this.cropStart.height + dy));
                    }
                    if (dir.includes('w')) {
                        const newX = Math.max(0, this.cropStart.x + dx);
                        const newWidth = this.cropStart.width - (newX - this.cropStart.x);
                        if (newWidth > 10) {
                            this.cropData.x = newX;
                            this.cropData.width = newWidth;
                        }
                    }
                    if (dir.includes('e')) {
                        this.cropData.width = Math.max(10, Math.min(this.image.width - this.cropData.x, this.cropStart.width + dx));
                    }
                    
                    this.cropData.x = Math.round(this.cropData.x);
                    this.cropData.y = Math.round(this.cropData.y);
                    this.cropData.width = Math.round(this.cropData.width);
                    this.cropData.height = Math.round(this.cropData.height);
                    
                    this.updatePreview();
                },
                updateCropBox() {
                    this.cropData.x = Math.max(0, Math.min(this.image.width - this.cropData.width, this.cropData.x));
                    this.cropData.y = Math.max(0, Math.min(this.image.height - this.cropData.height, this.cropData.y));
                    this.cropData.width = Math.max(1, Math.min(this.image.width - this.cropData.x, this.cropData.width));
                    this.cropData.height = Math.max(1, Math.min(this.image.height - this.cropData.y, this.cropData.height));
                    
                    this.updatePreview();
                },
                updatePreview() {
                    const previewCanvas = this.$refs.previewCanvas;
                    if (!previewCanvas) return;
                    
                    const ctx = previewCanvas.getContext('2d');
                    
                    const maxPreviewSize = 250;
                    let previewWidth = this.cropData.width;
                    let previewHeight = this.cropData.height;
                    
                    if (previewWidth > maxPreviewSize || previewHeight > maxPreviewSize) {
                        const scale = Math.min(maxPreviewSize / previewWidth, maxPreviewSize / previewHeight);
                        previewWidth = previewWidth * scale;
                        previewHeight = previewHeight * scale;
                    }
                    
                    previewCanvas.width = previewWidth;
                    previewCanvas.height = previewHeight;
                    
                    ctx.drawImage(
                        this.image,
                        this.cropData.x, this.cropData.y,
                        this.cropData.width, this.cropData.height,
                        0, 0,
                        previewWidth, previewHeight
                    );
                },
                resetCrop() {
                    this.initializeCrop();
                },
                downloadCroppedImage() {
                    if (!this.isValidCrop) {
                        alert('Please provide a valid crop area');
                        return;
                    }
                    
                    // Create a temporary canvas for the full-size cropped image
                    const tempCanvas = document.createElement('canvas');
                    const ctx = tempCanvas.getContext('2d');
                    
                    // Set canvas size to actual crop size (not scaled)
                    tempCanvas.width = this.cropData.width;
                    tempCanvas.height = this.cropData.height;
                    
                    // Draw the cropped portion at full resolution
                    ctx.drawImage(
                        this.image,
                        this.cropData.x, this.cropData.y,
                        this.cropData.width, this.cropData.height,
                        0, 0,
                        this.cropData.width, this.cropData.height
                    );
                    
                    // Convert canvas to blob and download
                    tempCanvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = this.cropData.updateFileName || 'cropped-image.jpg';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }, 'image/jpeg', 0.95);
                },
                submitCrop() {
                    if (!this.isValidCrop) {
                        alert('Please provide a valid crop area and update file name');
                        return;
                    }
                    
                    // Simulate API call
                    console.log('Submitting crop data:', this.cropData);
                    
                    // Here you would make your API call like:
                    // fetch('/api/crop', {
                    //     method: 'POST',
                    //     headers: { 'Content-Type': 'application/json' },
                    //     body: JSON.stringify(this.cropData)
                    // })
                    
                    this.showSuccess = true;
                    setTimeout(() => {
                        this.showSuccess = false;
                    }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>